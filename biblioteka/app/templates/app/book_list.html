{% extends 'app/base.html' %}
{% block title %}
    Manage books
{% endblock %}

{% block content %}
    
<h1>Books</h1>

<!-- Formularz wyszukiwania -->
<form method="get" action="{% url 'book_list' %}">
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="Search books..." name="search_query">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="submit">Search</button>
        </div>
    </div>
</form>


<div class="input-group-prepend">
    <ul>
        {% for book in books %}
            <li style="margin:3px">
                <strong>{{ book.title }}</strong> - {{ book.author }} - {{ book.genre }} ({{ book.year }}) - PUBLISHED BY {{ book.publisher }} -

                {% if book.available %}
                    <span style="color:green;">Available</span> 
                {% else %}
                    <span style="color:red;">Unavailable</span> 
                {% endif %}

                {% for group in user.groups.all %}
                    {% if group.name == 'Employees' %}
                    <form action="{% url 'delete_book' book.id %}" method="post" style="display: inline;" class="form-group">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-success">Delete</button>
                    </form>
                <a href="{% url 'edit_book' book.id %}" class="btn btn-success">Edit</a>
                {% endif %}
                {% endfor %}

                {% if book.available %}
                <form id="borrowForm{{ book.id }}" action="{% url 'borrow_book' book.id %}" method="post" style="display: inline;" class="form-group">
                    {% csrf_token %}
                    <button type="button" class="btn btn-primary borrowButton" data-book-id="{{ book.id }}">Borrow</button>
                    <div id="borrowFields{{ book.id }}" style="display: none;">
                        <label for="location">Location:</label>
                        <input type="text" id="location{{ book.id }}" name="location" required>
                        <label for="date">Date:</label>
                        <input type="date" id="date{{ book.id }}" name="date" required>
                        <button type="submit" class="btn btn-primary">Confirm Borrow</button>
                    </div>
                </form>
                {% endif %}

                {% if not book.available %}
                    {% if not book.borrowed_by == user %}
                    <form action="{% url 'add_to_wishlist' book.id %}" method="post">
                        {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Add to wishlist</button>
                    </form>
                    {% endif %}
                {% endif %}
            </li>
        {% endfor %}
    </ul>
</div>

{% for group in user.groups.all %}
    {% if group.name == 'Employees' %}
<a href="{% url 'add_book' %}" class="btn btn-success">Add a new book</a>
    {% endif %}
{% endfor %}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        var borrowButtons = document.querySelectorAll(".borrowButton");
        borrowButtons.forEach(function(button) {
            button.addEventListener("click", function() {
                var bookId = this.getAttribute("data-book-id");
                document.getElementById("borrowFields" + bookId).style.display = "block";
            });
        });
    });
</script>
      
    
{% endblock %}
